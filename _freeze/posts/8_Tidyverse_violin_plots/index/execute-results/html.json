{
  "hash": "b12326dec43a88eaf22f1c13d2727950",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidyverse and ggpubr: Violin plots and more\"\nauthor: \"Jie Wu\"\ndraft: false\ndate: \"2025-06-18\"\nformat: \n    html:\n        toc: true\n        toc-depth: 2\n        code-fold: false\ncategories: [\"Tidyverse\", \"Data Science\", \"R Programming\"]\n---\n\nIn this post, we'll enrich the mutation table from the previous blog by integrating additional sample annotations and omics signatures. Using tidyverse tools, we'll join these datasets and explore the results with violin and box plots to uncover meaningful biological insights.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all packages\nrequire(tidyverse)\nrequire(here)\n\n# Load the mutation table from the RDS file saved in the last post\nmutation_table <- readRDS(here(\"_data/mutation_matrix.rds\"))\n```\n:::\n\n\nNow download more tables from DepMap 24Q4:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://plus.figshare.com/ndownloader/files/51065297\"\nfile_path <- here(\"_data/Model.csv\")\n\nif (!file.exists(file_path)) {\n    download.file(url, file_path)\n}\n\nModel_anno <- read_csv(file_path, guess_max = Inf)\n\nurl <- \"https://plus.figshare.com/ndownloader/files/51065726\"\nfile_path <- here(\"_data/OmicsSignatures.csv\")\n\nif (!file.exists(file_path)) {\n    download.file(url, file_path)\n}\n\nModel_sigs <- read_csv(file_path, guess_max = Inf)\nnames(Model_sigs)[1] <- \"ModelID\"\n```\n:::\n\n\nLet's now bring all these tables together for a comprehensive dataset. We'll reshape the mutation table using `pivot_longer()` and `pivot_wider()` (instead of `t()`), then use `full_join()` from dplyr (instead of `merge()`) to combine everything into a single tidy data frame. This tidyverse-based workflow keeps things organized and makes downstream analysis and visualization much easier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmutation_table <- mutation_table %>%\n    pivot_longer(\n        cols = -HugoSymbol,\n        names_to = \"Sample\",\n        values_to = \"Mutation\"\n    ) %>% \n    pivot_wider(names_from = \"HugoSymbol\",\n                values_from = \"Mutation\"\n                )\n\ndata <- Model_anno %>%\n    full_join(Model_sigs,by=c(\"ModelID\")) %>%\n    full_join(mutation_table, by = c(\"ModelID\"=\"Sample\"))\n```\n:::\n\n\nNow that we have a combined table, let's visualize the relationship between KMT2D mutation status and MSI score using violin and boxplots. This can help us see if MSI tumors have more mutations in genes like KMT2D. Here we use `ggpubr`, which is built on `ggplot2` and makes publication-ready figures easier to create.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(ggpubr)\n\nggviolin(data %>% filter(!is.na(mut.KMT2D)),\n        x=\"mut.KMT2D\", y=\"MSIScore\", \n        add=c(\"boxplot\"), fill=\"mut.KMT2D\", \n        add.params = list(fill = \"white\", alpha=0.5), trim=T) +\n\t\tstat_compare_means(comparisons = list(c(\"0\",\"1\")), \n        label = \"p.signif\", show.legend=F )  +\n\t\tgeom_jitter( width=0.2, height=0)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nOne quick note: While `ggpubr` offers an `add = \"jitter\"` option for adding jittered points to your plots, in this example I used `geom_jitter()` from `ggplot2` directly. Both approaches work, but `geom_jitter()` provides a bit more flexibility if you want to customize the appearance of the points, especially in this case I do not want to jitter on y-axis.\n\nAgain, we save this data frame in a RDS file for later use\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsaveRDS(data, here(\"_data/combined_data.rds\"))\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}